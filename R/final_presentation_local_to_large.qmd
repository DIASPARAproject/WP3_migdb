---
title: "From local to large scale: a habitat database alongside a dam and an electrofishing database to shift from continental habitats to population or panpopulation scales"
author: "Cédric Briand, Jules Oliviéro, Jani Helminen"
fontsize: 20pt
filters:
  - quarto-kroki
  - speakernotes
title-slide-attributes:
  data-background-image: images/diaspara_background.png
  data-background-size: stretch
  data-background-opacity: "0.5"
logo: images/diaspara_participants_logo_withEUlogo.png
footer: ""
format: 
  revealjs :
    self-contained: true
  pdf:
    speakernotes:
      displayNotes: true
      customStyle: |
        roundcorner=5pt,
        subtitlebelowline=true,
        subtitleaboveline=true,
        subtitlebackgroundcolor=yellow!70!white,
        backgroundcolor=blue!20!white,
        frametitle={Theorem},
        frametitlerule=true,
        frametitlebackgroundcolor=yellow!70!white,
theme: solarized
background-transition: fade
editor: visual
---
```{r init}
#| echo: FALSE
#| warning: FALSE
#| message: FALSE
#| results: 'hide'

#if (!grepl("montepomi", getwd())) {
if(Sys.info()[["user"]] == 'joliviero'){
setwd("D:/workspace/DIASPARA_WP3_migdb/R")
datawd <- "D:/DIASPARA/wgbast"
} else if (Sys.info()[["user"]] == 'cedric.briand'){
setwd("C:/workspace/DIASPARA_WP3_migdb/R")
datawd <- "C:/Users/cedric.briand/OneDrive - EPTB Vilaine/Projets/DIASPARA/wgbast"
}
source("utilities/load_library.R")
load_library("tidyverse")
load_library("knitr")
load_library("kableExtra")
load_library("icesVocab")
load_library("readxl")
load_library("janitor")
load_library("skimr")
load_library("RPostgres")
load_library("yaml")
load_library("DBI")
load_library("ggplot2")
load_library("sf")
load_library("janitor") # clean_names
load_library("rnaturalearth")
load_library("htmltools")
cred <- read_yaml("../credentials.yml")
con_diaspara <- dbConnect(Postgres(), 
                           dbname = cred$dbnamehydro,
                           host = cred$hostmercure,
                           port = cred$port,
                           user = cred$usermercure,
                           password = cred$passwordmercure)
con_diaspara_admin <- dbConnect(Postgres(), 
                           dbname = cred$dbnamehydro,
                           host = cred$host,
                           port = cred$port,
                           user = cred$usersalmo,
                           password = cred$passwordsalmo)





```


## This presentation

::::: columns
::: {.column .incremental width="40%"}
![](images/clipboard-550275409.png "Eel and brown trout"){width="370"} ![](images/clipboard-639830824.png "electrofishing"){width="370"}
:::

::: {.column width="60%"}
-   [**Regional Models**]{style="font-size:45px"}

-   [**Data Examples**]{style="font-size:45px"}

-   [**Biological and Biometric data**]{style="font-size:45px"}
:::
:::::

## This presentation

::::: columns
::: {.column .incremental width="40%"}
![](images/clipboard-550275409.png "Eel and brown trout"){width="370"} ![](images/clipboard-639830824.png "electrofishing"){width="370"}
:::

::: {.column width="60%"}
-   [**Regional Models**]{style="font-size:45px"}

A big reason why we needed habitat database
:::
:::::

# What amazing species! What a scientific challenge!

**Remember from previous presentations:**

-   Nested dynamics: pooled marine phase, independent continental phase
-   Local pressures can have consequences at larger scale
    -   Management is often local: consequences at larger scale
    -   Assessment of management actions
-   Large scale pressure can impact local dynamics (e.g. marine fisheries)

# Taking different regions into account

**Remember from previous presentations:**

![](images/clipboard-1502028863.png)

# The spatial / habitat model?

-   WGTRUTTA & WGEEL
-   Regional aspects in WGNAS and WGBAST
-   **CEDRIC TO ADD??**

# Scale of each model? Not known

::::: columns
::: {.column .incremental width="50%"}
-   With this approach we can test different structures and levels
-   Data to collected locally, used in (m)any needed scale
:::

::: {.column width="50%"}
![](images/clipboard-3523976769.png)
:::
:::::

# Different pressures, quantification issues?

::::: columns
::: {.column .incremental width="50%"}
-   Obstacles, turbines matched to habitat
-   E.g., WGTRUTTA work
:::

::: {.column .incremental width="50%"}
-   Electrofishing similarly:
    -   Linking to habitat
:::
:::::

## This presentation

::::: columns
::: {.column .incremental width="40%"}
![](images/clipboard-550275409.png "Eel and brown trout"){width="370"} ![](images/clipboard-639830824.png "electrofishing"){width="370"}
:::

::: {.column width="60%"}
-   [**Data Examples**]{style="font-size:45px"}

This is why we have worked with the habitat data so intensively
:::
:::::

# Currently (or rather: in the past), only marine habitat available

-   Now, shift from marine only to marine & continental

-   ANYTHING FROM JULES HERE

## Habitat DB hierarchical structure
![WGBAST Hierarchical structure](images/fig-area_hierarchy_bast.svg){#fig-hierbast}

## Habitat DB hierarchical structure : Stock
![WGBAST Stock level](images/fig-area_hierarchy_bast_stock.svg){#fig-hierbastsck}

## Habitat DB hierarchical structure : Stock
```{r}
#| label: refbast.tr_area_are Stock level
#| echo: FALSE
#| warning: FALSE
#| message: FALSE
#| tbl-cap: Structure of the global Stock level in the referential table


fstock_lvl <- dbGetQuery(con_diaspara, 
  "SELECT are_id, are_are_id, are_code, are_lev_code, are_wkg_code, are_ismarine FROM refbast.tr_area_are
  WHERE are_lev_code = 'Stock'
  ORDER BY are_id;")

DT::datatable(fstock_lvl,
rownames = FALSE,
  options = list(
    pageLength = 7,        
    scrollX= TRUE   
  )
) |>
  htmltools::tagList(

 
    htmltools::tags$style(HTML("
      /* Table cells */
      table.dataTable td {
        font-size: 0.6em;
      }
 
      /* Table headers */
      table.dataTable th {
        font-size: 0.65em;
      }
 
      /* Control bar: search input, pagination, etc. */
      .dataTables_wrapper .dataTables_filter,
      .dataTables_wrapper .dataTables_length,
      .dataTables_wrapper .dataTables_info,
      .dataTables_wrapper .dataTables_paginate {
        font-size: 0.70em;
      }
    ")))

```
## Habitat DB hierarchical structure : Stock
![](images/bast_stock.png "WGBAST Stock level")

## Habitat DB hierarchical structure : Assessment_unit
![WGBAST Assesment_unit level](images/fig-area_hierarchy_bast_au.svg){#fig-hierbastau}

## Habitat DB hierarchical structure : Assessment_unit
```{r}
#| label: refbast.tr_area_are assessment unit level
#| echo: FALSE
#| warning: FALSE
#| message: FALSE
#| tbl-cap: Structure of the assessment unit level in the referential table


fstock_lvl <- dbGetQuery(con_diaspara, 
  "SELECT are_id, are_are_id, are_code, are_lev_code, are_wkg_code, are_ismarine FROM refbast.tr_area_are
  WHERE are_id = ANY(ARRAY[1,3]) OR are_lev_code = 'Assessment_unit' 
  ORDER BY are_id;")

DT::datatable(fstock_lvl,
rownames = FALSE,
  options = list(
    pageLength = 7,        
    scrollX= TRUE   
  )
) |>
  htmltools::tagList(

 
    htmltools::tags$style(HTML("
      /* Table cells */
      table.dataTable td {
        font-size: 0.6em;
      }
 
      /* Table headers */
      table.dataTable th {
        font-size: 0.65em;
      }
 
      /* Control bar: search input, pagination, etc. */
      .dataTables_wrapper .dataTables_filter,
      .dataTables_wrapper .dataTables_length,
      .dataTables_wrapper .dataTables_info,
      .dataTables_wrapper .dataTables_paginate {
        font-size: 0.70em;
      }
    ")))

#knitr::kable(fstock_lvl) %>% kable_styling(bootstrap_options = c("striped", "hover", "condensed"))

```

## Habitat DB hierarchical structure : Assessment_unit
![](images/bast_au.png "WGBAST Assessment_unit level")

## Habitat DB hierarchical structure : River
![WGBAST River level](images/fig-area_hierarchy_bast_riv.svg){#fig-hierbastriv}

## Habitat DB hierarchical structure : River
```{r}
#| label: refbast.tr_area_are main river level
#| echo: FALSE
#| warning: FALSE
#| message: FALSE
#| tbl-cap: Structure of the main river level in the referential table


fstock_lvl <- dbGetQuery(con_diaspara, 
  "SELECT are_id, are_are_id, are_code, are_lev_code, are_wkg_code, are_ismarine, are_name FROM refbast.tr_area_are
  WHERE are_id = ANY(ARRAY[1,3,13]) OR are_are_id = 13
  ORDER BY are_id;")

DT::datatable(fstock_lvl,
rownames = FALSE,
  options = list(
    pageLength = 7,        
    scrollX= TRUE   
  )
) |>
  htmltools::tagList(

 
    htmltools::tags$style(HTML("
      /* Table cells */
      table.dataTable td {
        font-size: 0.6em;
      }
 
      /* Table headers */
      table.dataTable th {
        font-size: 0.65em;
      }
 
      /* Control bar: search input, pagination, etc. */
      .dataTables_wrapper .dataTables_filter,
      .dataTables_wrapper .dataTables_length,
      .dataTables_wrapper .dataTables_info,
      .dataTables_wrapper .dataTables_paginate {
        font-size: 0.70em;
      }
    ")))

#knitr::kable(fstock_lvl) %>% kable_styling(bootstrap_options = c("striped", "hover", "condensed"))

```

## Habitat DB hierarchical structure : River
![](images/bast_river.png "WGBAST River level")

## Habitat DB hierarchical structure : River_section
![WGBAST River_section level](images/fig-area_hierarchy_bast_rivsec.svg){#fig-hierbastrvsc}

## Habitat DB hierarchical structure : River_section
```{r}
#| label: refbast.tr_area_are main river_section level
#| echo: FALSE
#| warning: FALSE
#| message: FALSE
#| tbl-cap: Structure of the main river level in the referential table


fstock_lvl <- dbGetQuery(con_diaspara, 
  "SELECT are_id, are_are_id, are_code, are_lev_code, are_wkg_code, are_ismarine, are_name FROM refbast.tr_area_are
  WHERE are_id = ANY(ARRAY[1,3,13,19]) OR are_are_id = 19
  ORDER BY are_id;")

DT::datatable(fstock_lvl,
rownames = FALSE,
  options = list(
    pageLength = 7,        
    scrollX= TRUE   
  )
) |>
  htmltools::tagList(

 
    htmltools::tags$style(HTML("
      /* Table cells */
      table.dataTable td {
        font-size: 0.6em;
      }
 
      /* Table headers */
      table.dataTable th {
        font-size: 0.65em;
      }
 
      /* Control bar: search input, pagination, etc. */
      .dataTables_wrapper .dataTables_filter,
      .dataTables_wrapper .dataTables_length,
      .dataTables_wrapper .dataTables_info,
      .dataTables_wrapper .dataTables_paginate {
        font-size: 0.70em;
      }
    ")))

#knitr::kable(fstock_lvl) %>% kable_styling(bootstrap_options = c("striped", "hover", "condensed"))

```

## Habitat DB hierarchical structure : River_section
![](images/bast_rs.png "WGBAST River_section level")

## Habitat DB hierarchical structure : Divison
![WGBAST Division level](images/fig-area_hierarchy_bast_div.svg){#fig-hierbastdiv}

## Habitat DB hierarchical structure : Divison
```{r}
#| label: refbast.tr_area_are ICES division level
#| echo: FALSE
#| warning: FALSE
#| message: FALSE
#| tbl-cap: Structure of the ICES division level in the referential table


fstock_lvl <- dbGetQuery(con_diaspara, 
  "SELECT are_id, are_are_id, are_code, are_lev_code, are_wkg_code, are_ismarine FROM refbast.tr_area_are
  WHERE are_id = ANY(ARRAY[1,2]) OR are_lev_code = 'Division'
  ORDER BY are_id;")

DT::datatable(fstock_lvl,
rownames = FALSE,
  options = list(
    pageLength = 7,        
    scrollX= TRUE   
  )
) |>
  htmltools::tagList(

 
    htmltools::tags$style(HTML("
      /* Table cells */
      table.dataTable td {
        font-size: 0.6em;
      }
 
      /* Table headers */
      table.dataTable th {
        font-size: 0.65em;
      }
 
      /* Control bar: search input, pagination, etc. */
      .dataTables_wrapper .dataTables_filter,
      .dataTables_wrapper .dataTables_length,
      .dataTables_wrapper .dataTables_info,
      .dataTables_wrapper .dataTables_paginate {
        font-size: 0.70em;
      }
    ")))

```

## Habitat DB hierarchical structure : Divison
![](images/bast_div.png "WGBAST Division level")

## Habitat DB hierarchical structure : Subdivision_grouping
![WGBAST Subdivision_grouping level](images/fig-area_hierarchy_bast_subgrp.svg){#fig-hierbastsubgr}

## Habitat DB hierarchical structure : Subdivision_grouping
```{r}
#| label: refbast.tr_area_are ICES subdivision_grouping level
#| echo: FALSE
#| warning: FALSE
#| message: FALSE
#| tbl-cap: Structure of the ICES subdivision grouping level in the referential table


fstock_lvl <- dbGetQuery(con_diaspara, 
  "SELECT are_id, are_are_id, are_code, are_lev_code, are_wkg_code, are_ismarine FROM refbast.tr_area_are
  WHERE are_id = ANY(ARRAY[1,2,7011]) OR are_lev_code = 'Subdivision_grouping'
  ORDER BY are_id;")

DT::datatable(fstock_lvl,
rownames = FALSE,
  options = list(
    pageLength = 7,        
    scrollX= TRUE   
  )
) |>
  htmltools::tagList(

 
    htmltools::tags$style(HTML("
      /* Table cells */
      table.dataTable td {
        font-size: 0.6em;
      }
 
      /* Table headers */
      table.dataTable th {
        font-size: 0.65em;
      }
 
      /* Control bar: search input, pagination, etc. */
      .dataTables_wrapper .dataTables_filter,
      .dataTables_wrapper .dataTables_length,
      .dataTables_wrapper .dataTables_info,
      .dataTables_wrapper .dataTables_paginate {
        font-size: 0.70em;
      }
    ")))

#knitr::kable(fstock_lvl) %>% kable_styling(bootstrap_options = c("striped", "hover", "condensed"))

```

## Habitat DB hierarchical structure : Subdivision_grouping
![](images/bast_subgr.png "WGBAST Subdivision_grouping level")

## Habitat DB hierarchical structure : Subdivision
![WGBAST Subdivision level](images/fig-area_hierarchy_bast_subdiv.svg){#fig-hierbastsub}

## Habitat DB hierarchical structure : Subdivision
```{r}
#| label: refbast.tr_area_are ICES subdivision level
#| echo: FALSE
#| warning: FALSE
#| message: FALSE
#| tbl-cap: Structure of the ICES subdivision level in the referential table


fstock_lvl <- dbGetQuery(con_diaspara, 
  "SELECT are_id, are_are_id, are_code, are_lev_code, are_wkg_code, are_ismarine FROM refbast.tr_area_are
  WHERE are_id = ANY(ARRAY[1,2]) OR are_lev_code = ANY(ARRAY['Division', 'Subdivision'])
  ORDER BY are_id;")

# DT::datatable(fstock_lvl,
#                 rownames = FALSE, 
#                 class = "stripe hover compact", 
#                 options = list(dom = 't',
#                           pageLength = 100))

DT::datatable(fstock_lvl,
rownames = FALSE,
  options = list(
    pageLength = 7,        
    scrollX= TRUE   
  )
) |>
  htmltools::tagList(

 
    htmltools::tags$style(HTML("
      /* Table cells */
      table.dataTable td {
        font-size: 0.6em;
      }
 
      /* Table headers */
      table.dataTable th {
        font-size: 0.65em;
      }
 
      /* Control bar: search input, pagination, etc. */
      .dataTables_wrapper .dataTables_filter,
      .dataTables_wrapper .dataTables_length,
      .dataTables_wrapper .dataTables_info,
      .dataTables_wrapper .dataTables_paginate {
        font-size: 0.70em;
      }
    ")))

#knitr::kable(fstock_lvl) %>% kable_styling(bootstrap_options = c("striped", "hover", "condensed"))

```



## Habitat DB hierarchical structure : Subdivision
![](images/bast_sub.png "WGBAST Subdivision level")

## Habitat DB hierarchical structure : WGEEL
![WGEEL Hierarchical structure](images/fig-area_hierarchy_wgeel.svg){#fig-hiereel}

## Habitat DB hierarchical structure : Regional
- EMUs are to be deprecated
- Creating a new structure to assess data

## Habitat DB hierarchical structure : Regional
![](images/wgeel_baltic.png "WGEEL Regional level")

## Habitat DB hierarchical structure : Regional
![](images/wgeel_norway.png "WGEEL Regional level")

## Habitat DB hierarchical structure : Regional
![](images/wgeel_nsea.png "WGEEL Regional level")

## Habitat DB hierarchical structure : Regional
![](images/wgeel_atlantic.png "WGEEL Regional level")

## Habitat DB hierarchical structure : Regional
![](images/wgeel_med.png "WGEEL Regional level")

## Habitat DB hierarchical structure : Complex
- Taking care of lagoons in the Mediterranean
- Creating groups of lagoons
- Available for Spain, France, Tunisia, Italia, Albania, Greece and Turkey

## Habitat DB hierarchical structure : Complex
![](images/greece_complex.png "WGEEL Regional level")

## Habitat DB hierarchical structure : Complex
![](images/french_complex.png "WGEEL Regional level")

## Habitat DB hierarchical structure : WGNAS
![WGNAS Hierarchical structure](images/fig-area_hierarchy_nas1.svg){#fig-hiernas}

## Habitat DB hierarchical structure : Assessment_unit
![](images/nas_aunit.png "WGNAS AU level")

## Habitat DB hierarchical structure : River
![](images/nas_riv.png "WGNAS River level")

## Habitat DB hierarchical structure : River
- Possibility to group river basins to create smaller assessment units

# Habitat DB to move from local to higher scale

-   Data structured in regional level for SAM
-   Need upscaling: need upscaling methods
-   Identify similar areas, identify different areas

# What is the appropriate spatial scale? Not known yet?

-   All have the structure to group things at regional level

![](images/clipboard-3102186189.png)

## This presentation

::::: columns
::: {.column .incremental width="40%"}
![](images/clipboard-550275409.png "Eel and brown trout"){width="370"} ![](images/clipboard-639830824.png "electrofishing"){width="370"}
:::

::: {.column width="60%"}
-   [**Biological and Biometric data**]{style="font-size:45px"}

A new way to use available data
:::
:::::

# New database - data available for use

-   This is an example why it was important to use ICES Vocabulary as much as possible

![](images/clipboard-2022634687.png)

# All groups have identified this need, but it was not easily accessible

::::: columns
::: {.column .incremental width="50%"}
-   Get the Biological data in a database
-   Use it for analysis
-   Understanding growth, fecundity, etc. **over time and spatially**
:::

::: {.column width="50%"}
![](images/clipboard-2516448368.png)
:::
:::::

# Thank you!