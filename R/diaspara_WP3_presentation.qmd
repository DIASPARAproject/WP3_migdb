---
title: "Creating database for migratory fishes"
subtitle: " To support a holistic and transparent assessment"
author: "C√©dric Briand, Jules Olivi√©ro, Jani Helminen"
filters:
  - quarto-kroki
  - speakernotes
title-slide-attributes:
  data-background-image: images/title_slide.png
  data-background-size: stretch
  data-background-opacity: "0.5"
logo: images/diaspara_participants_logo.png
footer: "WGEEL 2024 work"
format: 
  revealjs :
    speakernotes:
      displayNotes: true
  pdf:
    speakernotes:
      displayNotes: true
      customStyle: |
        roundcorner=5pt,
        subtitlebelowline=true,
        subtitleaboveline=true,
        subtitlebackgroundcolor=yellow!70!white,
        backgroundcolor=blue!20!white,
        frametitle={Theorem},
        frametitlerule=true,
        frametitlebackgroundcolor=yellow!70!white,
theme: solarized
background-transition: fade
editor: visual
---

# Habitat DB {.smaller}

:::::: columns
::: column
![](images/catchments_map.png){.absolute top="110" left="-30" width="550" height="600"}
:::

:::: column
::: incremental
-   Continental habitat¬†: Rivers, Estuaries, lakes, marsh, lagoons (Mediterranean, Atlantic, Baltic)
-   CCM, hydro-Atlas (Southern mediterranean), national databases.
-   Hierachical structure in postgis.
-   WKSMEEL (2023)
:::
::::
::::::

::: notes
Notes for habitat db
:::

## Habitat DB
Format : Geoparquet, Postgis schema

We intend to deliver several releases (ZENODO ?)
```{dot}
digraph {
    //rankdir=TB; // Top-to-bottom orientation
    compound=true;
    newrank=true;
    A [label="2001", shape=box];
    B [label="2002", shape=box];
    C [label="2003", shape=box];
    D [label="FR", shape=ellipse];
    E [label="ES", shape=ellipse];
    F [label="SE", shape=ellipse];
    G [label="CCM | Topo | Habitat | Eel | Salmon | Trout", shape=box];
    H [label="Ecrins | Topo | Habitat | Eel | Salmon | Trout", shape=box];
    L [label="NAT | Topo | Habitat | Eel | Salmon | Trout", shape=box];

    subgraph clusterA {
      label = "CCM, HydroAtlas, Ecrins, Regions";
      style=dashed;
      color=black;
      A;
      B;
      C;
    }

    subgraph clusterB {
      label = "Country or regions layer";
      style=dashed;
      color=black;
      D;
      E;
      F;
    }

    
    B -> E [ltail=clusterA,lhead=clusterB,minlen=2];
    E -> G,H [ltail=clusterB];

    I [label="Salmon River / Stock units", shape=box];
    J [label="Fishing areas", shape=box];
    K [label="EMU (Eel Managment Unit)", shape=box];


    {rank=same;D;E;F;}
    {rank=same;A;B;C;I;J;K}
    {rank=same;G;H;L;} 

    subgraph clusterC {
      label = "";
      style=dashed;
      color=black;
      I;
      J;
      K;
    }

    K -> A [ltail=clusterC,lhead=clusterA,minlen=4];
    //L -> H [style=invis]
}
```



# SAM DB

## WGBAST

::::: columns
:::: column
![](images/assessment_units_wgbast.jpg){.absolute width="400" height="500"}
::::

:::: column
::: {.incremental}
- Three main groups of salmon populations
  - Gulf of Bothnia
  - Southern Sweden
  - Gulf of Finland and eastern Main Basin
:::
::::
:::::

## WGNAS

gfjhgjhjf

![](images\phylogeographic_structuring_salmon.png){.r-stretch}

## WGEEL

![](images\EMUs.png){.r-stretch}

## Global {.smaller}
The database structure could be simplified to the following structure
![](images\SAM_database.png){.r-stretch}

## Global - Regional Units

![](images\SAM_RU.png)

## Global - Data type

![](images\SAM_DT.png)

## Global - Life stage

![](images\SAM_LS.png)

## Global - Year/period

![](images\SAM_YP.png)

## Global - Age

![](images\SAM_A.png)

## Global - Data source

![](images\SAM_DS.png)

## Global - Origin

![](images\SAM_O.png)

## Global - Habitat

![](images\SAM_H.png)

## Global - ICES subdivisions

![](images\SAM_ICESS.png)


# Dam DB
::::columns
:::column
-   Different resolution in different countries.
-   Dbeel
:::
:::column
```{dot}
digraph {
    compound=true;
    newrank=true;

    A [label="GIS"];
    B [label="Time"];
    C [label="HPP"];
    D [label="Turbine"];
    E [label="Name"];
    F [label="Type"];
    G [label="Hierarchy"];
    H [label="Fishway"];
    I [label="Cumulative impact"];
    J [label="Up / Down"];
    subgraph clusterA{
      label="";
      style=dashed;
      color=black;
      E; F; G;
    }
    subgraph clusterB{
      label="";
      style=dashed;
      color=black;
      J;I;
    }

    {rank=same;A;E;F;G;}
    {rank=same;B;H;I;J;}
    A -> B -> C -> D
    A -> G [lhead=clusterA,minlen=3]
    B -> H -> J [lhead=clusterB,minlen=3]
}
```
:::
::::

# Dam DB
```{dot}
graph G{
  newrank=true;
  rankdir=LR;
  splines=false;
  outputorder=nodesfirst;

  A [label="Observation place",shape=box];
  B [label="Observation",shape=box];
  C [label="Pressure impact",shape=box];
  D [label="üîë üåê üìÑ",shape=box];
  E [label="Height",shape=box];
  F [label="Passability",shape=box];
  G [label="Downstream problem",shape=box];
  I [label="Presence eel pass (+ date)",shape=box];
  H [label="Fishway type",shape=box];
  J [label="Hydropower plant",shape=box];
  K [label="Turbine",shape=box];
  L [label="Bypass",shape=box];

  {rank=same;A;B}
  {rank=same;D;C}



  A -- B
  B -- C
  C -- D
  C -- E
  C -- F
  C -- G
  C -- H
  C -- I
  C -- J
  J -- K
  J -- L
}
```
# Geographical structure

```{dot}
digraph {
    compound=true;
    newrank=true;

    A [label="Rivers bassins",shape="box"] 
    B [style=invis]


    subgraph clusterA {
      label = "Complex / Area (NAC,NEC / Baltic, Med)";
      style=full;
      color=black;
      center=true;

      subgraph clusterB {
        label = "Country";
        style=full;
        color=black;
        center=true;
    
        subgraph clusterC {
          label = "Regions within country (EMU, Ireland.N_FO...)";
          style=full;
          color=black;
          A;
        }
      }
      subgraph clusterD{
        label="Fishing areas (Faroes)";
        style="full";
        color="black";
        B
      }
    }     
  }
```

# Electrofishing DB

# Time series - sampling and individual data (LHT)

## BlockDiag

````{=html}
<!---
```kroki-blockdiag
#| eval: false
blockdiag {
  Hello -> World ;
  Hello [color = "greenyellow"];
  World [color = "orange"];
}
```
-->
````